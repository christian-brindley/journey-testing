{
  "meta": {
    "origin": "https://openam-brindley.forgeblocks.com/platform/?realm=alpha#/journeys",
    "exportedBy": "christian.brindley@forgerock.com",
    "exportDate": "2024-10-21T17:52:50.652Z",
    "exportTool": "platform-admin ui tree export",
    "exportToolVersion": "1.0",
    "treesSelectedForExport": [
      "Login"
    ],
    "innerTreesIncluded": [
      "Login - MFA"
    ]
  },
  "trees": {
    "Login - MFA": {
      "tree": {
        "_id": "Login - MFA",
        "_rev": "-1755134061",
        "identityResource": "managed/alpha_user",
        "uiConfig": {
          "categories": "[]"
        },
        "entryNodeId": "05bb1d30-1a3d-4453-865f-ece400addb84",
        "innerTreeOnly": true,
        "nodes": {
          "05bb1d30-1a3d-4453-865f-ece400addb84": {
            "connections": {
              "true": "50762e08-e72b-4f5e-8d1d-3637a8dcfe66"
            },
            "displayName": "MFA Warning",
            "nodeType": "PageNode",
            "x": 208,
            "y": 187.02777862548828
          },
          "50762e08-e72b-4f5e-8d1d-3637a8dcfe66": {
            "connections": {
              "outcome": "f3ccbe16-5ed8-4d18-94b7-fc71161d707e"
            },
            "displayName": "Generate OTP",
            "nodeType": "OneTimePasswordGeneratorNode",
            "x": 415.517333984375,
            "y": 196.25
          },
          "5b734c01-3185-4d86-a729-a5e073420258": {
            "connections": {
              "false": "ff535a86-6667-4f0f-9ee9-a50cfc6ac36a",
              "true": "ee1c4377-7006-41c7-984d-463532453cb6"
            },
            "displayName": "Collect OTP",
            "nodeType": "PageNode",
            "x": 846.6284484863281,
            "y": 193.25
          },
          "792996c1-ab0e-4416-a7de-e372bd55dfc9": {
            "connections": {
              "outcome": "70e691a5-1e33-4ac3-a356-e7b6d60d92e0"
            },
            "displayName": "Device Profile Save",
            "nodeType": "DeviceSaveNode",
            "x": 1300,
            "y": 190.25
          },
          "ee1c4377-7006-41c7-984d-463532453cb6": {
            "connections": {
              "false": "70e691a5-1e33-4ac3-a356-e7b6d60d92e0",
              "true": "792996c1-ab0e-4416-a7de-e372bd55dfc9"
            },
            "displayName": "Remember Me",
            "nodeType": "PageNode",
            "x": 1082.3333435058594,
            "y": 192.25
          },
          "f3ccbe16-5ed8-4d18-94b7-fc71161d707e": {
            "connections": {
              "error": "e301438c-0bd0-429c-ab0c-66126501069a",
              "success": "5b734c01-3185-4d86-a729-a5e073420258"
            },
            "displayName": "Send Verification Email",
            "nodeType": "ScriptedDecisionNode",
            "x": 613.1840057373047,
            "y": 189.25
          },
          "ff535a86-6667-4f0f-9ee9-a50cfc6ac36a": {
            "connections": {
              "Reject": "e301438c-0bd0-429c-ab0c-66126501069a",
              "Retry": "5b734c01-3185-4d86-a729-a5e073420258"
            },
            "displayName": "Retry OTP",
            "nodeType": "RetryLimitDecisionNode",
            "x": 859,
            "y": 390.25
          }
        },
        "staticNodes": {
          "70e691a5-1e33-4ac3-a356-e7b6d60d92e0": {
            "x": 1513,
            "y": 296
          },
          "e301438c-0bd0-429c-ab0c-66126501069a": {
            "x": 1515,
            "y": 430
          },
          "startNode": {
            "x": 50,
            "y": 250
          }
        },
        "mustRun": false,
        "enabled": true
      },
      "nodes": {
        "05bb1d30-1a3d-4453-865f-ece400addb84": {
          "_id": "05bb1d30-1a3d-4453-865f-ece400addb84",
          "_rev": "937928312",
          "nodes": [
            {
              "_id": "69c97245-ec4f-4349-8bff-4fe45fe70ae4",
              "nodeType": "ScriptedDecisionNode",
              "displayName": "Next"
            }
          ],
          "pageDescription": {},
          "stage": "mfaWarning",
          "pageHeader": {},
          "_type": {
            "_id": "PageNode",
            "name": "Page Node",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "true",
              "displayName": "true"
            }
          ]
        },
        "50762e08-e72b-4f5e-8d1d-3637a8dcfe66": {
          "_id": "50762e08-e72b-4f5e-8d1d-3637a8dcfe66",
          "_rev": "1098962411",
          "length": 6,
          "_type": {
            "_id": "OneTimePasswordGeneratorNode",
            "name": "HOTP Generator",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "outcome",
              "displayName": "Outcome"
            }
          ]
        },
        "5b734c01-3185-4d86-a729-a5e073420258": {
          "_id": "5b734c01-3185-4d86-a729-a5e073420258",
          "_rev": "364739230",
          "nodes": [
            {
              "_id": "5df49c00-6dd7-4de7-a68b-4a9f1f1a7728",
              "nodeType": "OneTimePasswordCollectorDecisionNode",
              "displayName": "Verify OTP"
            }
          ],
          "pageDescription": {},
          "stage": "collectEmailOtp",
          "pageHeader": {},
          "_type": {
            "_id": "PageNode",
            "name": "Page Node",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "true",
              "displayName": "True"
            },
            {
              "id": "false",
              "displayName": "False"
            }
          ]
        },
        "792996c1-ab0e-4416-a7de-e372bd55dfc9": {
          "_id": "792996c1-ab0e-4416-a7de-e372bd55dfc9",
          "_rev": "-1099176012",
          "maxSavedProfiles": 5,
          "saveDeviceMetadata": true,
          "saveDeviceLocation": true,
          "_type": {
            "_id": "DeviceSaveNode",
            "name": "Device Profile Save",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "outcome",
              "displayName": "Outcome"
            }
          ]
        },
        "ee1c4377-7006-41c7-984d-463532453cb6": {
          "_id": "ee1c4377-7006-41c7-984d-463532453cb6",
          "_rev": "-1964089830",
          "nodes": [
            {
              "_id": "f4b6cdd7-df42-4d94-9134-483893cdf3ef",
              "nodeType": "MessageNode",
              "displayName": "Remember"
            }
          ],
          "pageDescription": {},
          "stage": "rememberMe",
          "pageHeader": {},
          "_type": {
            "_id": "PageNode",
            "name": "Page Node",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "true",
              "displayName": "True"
            },
            {
              "id": "false",
              "displayName": "False"
            }
          ]
        },
        "f3ccbe16-5ed8-4d18-94b7-fc71161d707e": {
          "_id": "f3ccbe16-5ed8-4d18-94b7-fc71161d707e",
          "_rev": "974802392",
          "script": "10c8e0f5-84ae-4035-9d10-04deb5258e15",
          "outcomes": [
            "success",
            "error"
          ],
          "outputs": [
            "*"
          ],
          "inputs": [
            "*"
          ],
          "_type": {
            "_id": "ScriptedDecisionNode",
            "name": "Scripted Decision",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "success",
              "displayName": "success"
            },
            {
              "id": "error",
              "displayName": "error"
            }
          ]
        },
        "ff535a86-6667-4f0f-9ee9-a50cfc6ac36a": {
          "_id": "ff535a86-6667-4f0f-9ee9-a50cfc6ac36a",
          "_rev": "-241480380",
          "incrementUserAttributeOnFailure": true,
          "retryLimit": 3,
          "_type": {
            "_id": "RetryLimitDecisionNode",
            "name": "Retry Limit Decision",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "Retry",
              "displayName": "Retry"
            },
            {
              "id": "Reject",
              "displayName": "Reject"
            }
          ]
        }
      },
      "innerNodes": {
        "69c97245-ec4f-4349-8bff-4fe45fe70ae4": {
          "_id": "69c97245-ec4f-4349-8bff-4fe45fe70ae4",
          "_rev": "314499023",
          "script": "7fe369b1-8c96-4d26-944c-5b608488187a",
          "outcomes": [
            "true"
          ],
          "outputs": [
            "*"
          ],
          "inputs": [
            "*"
          ],
          "_type": {
            "_id": "ScriptedDecisionNode",
            "name": "Scripted Decision",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "true",
              "displayName": "true"
            }
          ]
        },
        "5df49c00-6dd7-4de7-a68b-4a9f1f1a7728": {
          "_id": "5df49c00-6dd7-4de7-a68b-4a9f1f1a7728",
          "_rev": "1740638365",
          "passwordExpiryTime": 5,
          "_type": {
            "_id": "OneTimePasswordCollectorDecisionNode",
            "name": "OTP Collector Decision",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "true",
              "displayName": "True"
            },
            {
              "id": "false",
              "displayName": "False"
            }
          ]
        },
        "f4b6cdd7-df42-4d94-9134-483893cdf3ef": {
          "_id": "f4b6cdd7-df42-4d94-9134-483893cdf3ef",
          "_rev": "-1417041442",
          "messageYes": {
            "en": "Yes"
          },
          "message": {
            "en": "Remember this device"
          },
          "messageNo": {
            "en": "No"
          },
          "_type": {
            "_id": "MessageNode",
            "name": "Message Node",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "true",
              "displayName": "True"
            },
            {
              "id": "false",
              "displayName": "False"
            }
          ]
        }
      },
      "scripts": {
        "10c8e0f5-84ae-4035-9d10-04deb5258e15": {
          "_id": "10c8e0f5-84ae-4035-9d10-04deb5258e15",
          "name": "demo-send-otp-email",
          "description": "null",
          "script": "\"/**\\n * @file This script sends a templated HOTP to a user via the IDM's configured email service\\n * using the openidm binding in next-gen scripting\\n * NOTE - The use of SendGrid is not supported in Production and must be changed to your own email service\\n * Steps are here: https://backstage.forgerock.com/docs/idcloud/latest/tenants/email-provider.html#external_smtp_email_server\\n * @version 0.2.0\\n * @keywords email mail hotp sharedState transientState templateService\\n */\\n\\n/**\\n * Script configuration\\n*/\\n\\n// Uncomment to Initialise the logger called ds-node-logger-lib library script\\n// XLogger = require(\\\"ds-node-logger-lib\\\").XLogger;\\n// logger = new XLogger(this);\\n\\nvar config = {\\n    /**\\n     * @property {string} templateID - Identifier of email template\\n     * @property {string} idmEndpoint - IDM Endpoint used to send templated emails\\n     * @property {string} idmAction - IDM action executed against the idmEndpoint\\n     */\\n\\n    templateID: \\\"otp\\\",\\n    idmEndpoint: \\\"external/email\\\",\\n    idmAction: \\\"sendTemplate\\\"\\n};\\n\\n/**\\n * Node outcomes\\n*/\\nvar nodeOutcome = {\\n    PASS: \\\"sent\\\",\\n    FAIL: \\\"noMail\\\",\\n    ERROR: \\\"error\\\"\\n};\\n\\n/**\\n * Send email via the IDM Email Service openidm binding in next-gen scripting\\n * \\n * @param {string} hotp - HOTP retrieved from transientState\\n * @param {string} mail - mail attribute retrieved from the idRepository. Note if this is a registration journey acquire mail from sharedState\\n * @param {string} givenName - givenName attribute retrieved from the idRepository. Note if this is a registration journey acquire givenName from sharedState\\n */\\n\\nfunction sendMail(hotp, mail, givenName) {\\n    try {\\n        var params = new Object();\\n        params.templateName = config.templateID;\\n        params.to = mail;\\n        params.object = {\\n            \\\"givenName\\\": givenName,\\n            \\\"otp\\\": hotp\\n        };\\n        openidm.action(config.idmEndpoint, config.idmAction, params);\\n        logger.debug(\\\"Email sent successfully\\\");\\n        return nodeOutcome.PASS;\\n    }\\n    catch (e) {\\n        logger.error(\\\"Failed to call IDM Email endpoint using template. Exception is: \\\" + e);\\n        return nodeOutcome.ERROR;\\n    }\\n};\\n\\n/**\\n * Main function\\n */\\n\\n(function () {\\n    logger.debug(\\\"Node execution started\\\");\\n    var id;\\n    var hotp;\\n    var mail;\\n\\n    if (!(id = nodeState.get(\\\"_id\\\"))) {\\n        logger.error(\\\"Unable to retrieve Identity\\\");\\n        action.goTo(nodeOutcome.ERROR);\\n        return;\\n    } else {\\n        var identity = idRepository.getIdentity(id);\\n    }\\n\\n    if (!(hotp = nodeState.get(\\\"oneTimePassword\\\"))) {\\n        logger.error(\\\"Unable to retrieve HOTP from state\\\");\\n        action.goTo(nodeOutcome.ERROR);\\n        return;\\n    }\\n\\n    //If this is a registration journey adapt the following to try retrieve from nodeState\\n    if (!(mail = identity.getAttributeValues(\\\"mail\\\").toArray()[0])) {\\n        logger.error(\\\"Unable to retrieve mail attribute from the idRepository\\\");\\n        action.goTo(nodeOutcome.FAIL);\\n        return;\\n    }\\n\\n    //If this is a registration journey adapt the following to try retrieve from nodeState\\n    //Be sure to set givenName against the user\\n    if (!(givenName = identity.getAttributeValues(\\\"givenName\\\").toArray()[0])) {\\n        logger.error(\\\"Unable to retrieve givenName attribute from the idRepository\\\");\\n        action.goTo(nodeOutcome.FAIL);\\n        return;\\n    }\\n\\n    //Execute function to send mail\\n    outcome = sendMail(hotp, mail, givenName);\\n})();\"",
          "default": false,
          "language": "JAVASCRIPT",
          "context": "AUTHENTICATION_TREE_DECISION_NODE",
          "createdBy": "null",
          "creationDate": 0,
          "lastModifiedBy": "null",
          "lastModifiedDate": 0,
          "evaluatorVersion": "2.0"
        },
        "7fe369b1-8c96-4d26-944c-5b608488187a": {
          "_id": "7fe369b1-8c96-4d26-944c-5b608488187a",
          "name": "demo-noop",
          "description": "null",
          "script": "\"/**\\n * @file This script provides a no-op node for embedding in an informational page\\n * @version 0.1.1\\n * @keywords noop \\n */\\n\\n/**\\n * Node outcomes\\n */\\n\\nvar NodeOutcome = {\\n    SUCCESS: \\\"true\\\"\\n};\\n\\nvar fr = JavaImporter(\\n    org.forgerock.openam.auth.node.api.Action, \\n    com.sun.identity.authentication.callbacks.HiddenValueCallback\\n);\\n\\nif (callbacks.isEmpty()) { \\n    \\n    action = fr.Action.send(\\n        new fr.HiddenValueCallback(\\\"none\\\")\\n    ).build();\\n} \\nelse {\\n    action = fr.Action.goTo(NodeOutcome.SUCCESS).build();        \\n}\"",
          "default": false,
          "language": "JAVASCRIPT",
          "context": "AUTHENTICATION_TREE_DECISION_NODE",
          "createdBy": "null",
          "creationDate": 0,
          "lastModifiedBy": "null",
          "lastModifiedDate": 0,
          "evaluatorVersion": "1.0"
        }
      },
      "emailTemplates": {},
      "socialIdentityProviders": {},
      "themes": [],
      "saml2Entities": {},
      "circlesOfTrust": {}
    },
    "Login": {
      "tree": {
        "_id": "Login",
        "_rev": "-778133909",
        "identityResource": "managed/alpha_user",
        "uiConfig": {
          "categories": "[]"
        },
        "entryNodeId": "11c44cdc-337c-4242-b84e-c066d360ea19",
        "innerTreeOnly": false,
        "nodes": {
          "11c44cdc-337c-4242-b84e-c066d360ea19": {
            "connections": {
              "outcome": "22f404bf-ff51-4e3b-97e6-cdae8d2e08a4"
            },
            "displayName": "Userid Passsword",
            "nodeType": "PageNode",
            "x": 188,
            "y": 118.71875
          },
          "22f404bf-ff51-4e3b-97e6-cdae8d2e08a4": {
            "connections": {
              "CANCELLED": "e301438c-0bd0-429c-ab0c-66126501069a",
              "EXPIRED": "e301438c-0bd0-429c-ab0c-66126501069a",
              "FALSE": "a3107dd4-3909-40e5-8f39-0e0112806693",
              "LOCKED": "e301438c-0bd0-429c-ab0c-66126501069a",
              "TRUE": "70e691a5-1e33-4ac3-a356-e7b6d60d92e0"
            },
            "displayName": "Identity Store Decision",
            "nodeType": "IdentityStoreDecisionNode",
            "x": 409,
            "y": 119.25
          },
          "7c5e97d2-6cd3-469c-81eb-6ef2529fa12a": {
            "connections": {
              "false": "9bd69490-91eb-40b9-bce9-3eda1a52b849",
              "true": "70e691a5-1e33-4ac3-a356-e7b6d60d92e0",
              "unknownDevice": "9bd69490-91eb-40b9-bce9-3eda1a52b849"
            },
            "displayName": "Device Match",
            "nodeType": "DeviceMatchNode",
            "x": 879.517333984375,
            "y": 128.25
          },
          "9bd69490-91eb-40b9-bce9-3eda1a52b849": {
            "connections": {
              "false": "e301438c-0bd0-429c-ab0c-66126501069a",
              "true": "70e691a5-1e33-4ac3-a356-e7b6d60d92e0"
            },
            "displayName": "MFA",
            "nodeType": "InnerTreeEvaluatorNode",
            "x": 1103,
            "y": 211.01040649414062
          },
          "a3107dd4-3909-40e5-8f39-0e0112806693": {
            "connections": {
              "Reject": "e301438c-0bd0-429c-ab0c-66126501069a",
              "Retry": "11c44cdc-337c-4242-b84e-c066d360ea19"
            },
            "displayName": "Retry",
            "nodeType": "RetryLimitDecisionNode",
            "x": 424,
            "y": 346.25
          },
          "fd5a2143-2f00-44aa-bf0f-105e0ff44897": {
            "connections": {
              "outcome": "7c5e97d2-6cd3-469c-81eb-6ef2529fa12a"
            },
            "displayName": "Device Profile Collector",
            "nodeType": "DeviceProfileCollectorNode",
            "x": 643.517333984375,
            "y": 124.25
          }
        },
        "staticNodes": {
          "70e691a5-1e33-4ac3-a356-e7b6d60d92e0": {
            "x": 1410,
            "y": 153
          },
          "e301438c-0bd0-429c-ab0c-66126501069a": {
            "x": 1410,
            "y": 405
          },
          "startNode": {
            "x": 50,
            "y": 250
          }
        },
        "mustRun": false,
        "enabled": true
      },
      "nodes": {
        "11c44cdc-337c-4242-b84e-c066d360ea19": {
          "_id": "11c44cdc-337c-4242-b84e-c066d360ea19",
          "_rev": "-1423516896",
          "nodes": [
            {
              "_id": "c98b9e90-d0b3-4411-8e43-d34585452ed9",
              "nodeType": "UsernameCollectorNode",
              "displayName": "Username Collector"
            },
            {
              "_id": "79b8d6f1-fba7-4c6d-9873-86b904600f35",
              "nodeType": "PasswordCollectorNode",
              "displayName": "Password Collector"
            }
          ],
          "pageDescription": {},
          "stage": "collectUserPass",
          "pageHeader": {
            "en": "&{esv.variable.1}"
          },
          "_type": {
            "_id": "PageNode",
            "name": "Page Node",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "outcome",
              "displayName": "Outcome"
            }
          ]
        },
        "22f404bf-ff51-4e3b-97e6-cdae8d2e08a4": {
          "_id": "22f404bf-ff51-4e3b-97e6-cdae8d2e08a4",
          "_rev": "547227717",
          "useUniversalIdForUsername": true,
          "minimumPasswordLength": 8,
          "mixedCaseForPasswordChangeMessages": false,
          "_type": {
            "_id": "IdentityStoreDecisionNode",
            "name": "Identity Store Decision",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "TRUE",
              "displayName": "True"
            },
            {
              "id": "FALSE",
              "displayName": "False"
            },
            {
              "id": "LOCKED",
              "displayName": "Locked"
            },
            {
              "id": "CANCELLED",
              "displayName": "Cancelled"
            },
            {
              "id": "EXPIRED",
              "displayName": "Expired"
            }
          ]
        },
        "7c5e97d2-6cd3-469c-81eb-6ef2529fa12a": {
          "_id": "7c5e97d2-6cd3-469c-81eb-6ef2529fa12a",
          "_rev": "509518830",
          "script": "01e1a3c0-038b-4c16-956a-6c9d89328cff",
          "acceptableVariance": 0,
          "expiration": 30,
          "useScript": false,
          "_type": {
            "_id": "DeviceMatchNode",
            "name": "Device Match",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "true",
              "displayName": "True"
            },
            {
              "id": "false",
              "displayName": "False"
            },
            {
              "id": "unknownDevice",
              "displayName": "Unknown Device"
            }
          ]
        },
        "9bd69490-91eb-40b9-bce9-3eda1a52b849": {
          "_id": "9bd69490-91eb-40b9-bce9-3eda1a52b849",
          "_rev": "1703290162",
          "tree": "Login - MFA",
          "_type": {
            "_id": "InnerTreeEvaluatorNode",
            "name": "Inner Tree Evaluator",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "true",
              "displayName": "True"
            },
            {
              "id": "false",
              "displayName": "False"
            }
          ]
        },
        "a3107dd4-3909-40e5-8f39-0e0112806693": {
          "_id": "a3107dd4-3909-40e5-8f39-0e0112806693",
          "_rev": "-504375749",
          "incrementUserAttributeOnFailure": true,
          "retryLimit": 3,
          "_type": {
            "_id": "RetryLimitDecisionNode",
            "name": "Retry Limit Decision",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "Retry",
              "displayName": "Retry"
            },
            {
              "id": "Reject",
              "displayName": "Reject"
            }
          ]
        },
        "fd5a2143-2f00-44aa-bf0f-105e0ff44897": {
          "_id": "fd5a2143-2f00-44aa-bf0f-105e0ff44897",
          "_rev": "-2101079401",
          "deviceLocation": false,
          "maximumSize": "3",
          "deviceMetadata": true,
          "message": {},
          "_type": {
            "_id": "DeviceProfileCollectorNode",
            "name": "Device Profile Collector",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "outcome",
              "displayName": "Outcome"
            }
          ]
        }
      },
      "innerNodes": {
        "c98b9e90-d0b3-4411-8e43-d34585452ed9": {
          "_id": "c98b9e90-d0b3-4411-8e43-d34585452ed9",
          "_rev": "-1274054009",
          "_type": {
            "_id": "UsernameCollectorNode",
            "name": "Username Collector",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "outcome",
              "displayName": "Outcome"
            }
          ]
        },
        "79b8d6f1-fba7-4c6d-9873-86b904600f35": {
          "_id": "79b8d6f1-fba7-4c6d-9873-86b904600f35",
          "_rev": "-160524843",
          "_type": {
            "_id": "PasswordCollectorNode",
            "name": "Password Collector",
            "collection": true
          },
          "_outcomes": [
            {
              "id": "outcome",
              "displayName": "Outcome"
            }
          ]
        }
      },
      "scripts": {},
      "emailTemplates": {},
      "socialIdentityProviders": {},
      "themes": [],
      "saml2Entities": {},
      "circlesOfTrust": {}
    }
  }
}